extends ../../layout

block content
  h1= edit ? __('Edit session') : __('New session')
  
  .btn-group(role='toolbar')
    if edit
      a.btn.btn-lg.btn-default(href='/sessions/' + session.id title='View this session')
        span.fa.fa-eye.fa-lg
    else
      a.btn.btn-lg.btn-default(href='/sessions' title='List of sessions')
        span.fa.fa-calendar.fa-lg
      a.btn.btn-lg.btn-default(href='/projects/new' title='Create new project')
        span.fa.fa-lg.fa-plus
        |  
        span.fa.fa-lg.fa-file-o
      a.btn.btn-lg.btn-default(href='/sessions/new' title='Create new session')
        span.fa.fa-lg.fa-plus
        |  
        span.fa.fa-lg.fa-clock-o
    if edit
      include toolbar 
  p  

  form.form-horizontal(method='post')
    input(type='hidden' name='_csrf', value=csrf)
    input#zoneOffset(type='hidden' name='zoneOffset' value=session.zoneOffset || '')
    
    - var summaryErr = _.find(validate, { path: 'summary' }) || ''
    
    .form-group(class=(summaryErr ? 'has-error' : ''))
      label.col-sm-2.control-label(for='summary')= __('Summary')
      .col-sm-10
        input#summary.form-control(type='text' name='summary' placeholder=__('Summary') value=session.summary aria-describedby='summaryhelp')
        span#summaryhelp.help-block= __(summaryErr ? summaryErr.message : 'A concise summary of this writing session (optional).')
        
    - var projectErr = _.find(validate, { path: 'project' }) || ''
        
    .form-group(class=(projectErr ? 'has-error' : ''))
      label.col-sm-2.control-label(for='project')= __('Project')
      .col-sm-10
        select#project.form-control(name='project' aria-describedby='projecthelp')
          for proj in projects
            option(value=proj.id selected=proj.id == session['project.id'])= proj.name
        span#projecthelp.help-block= __(projectErr ? projectErr.message : 'Select the project written within this session.')

    - var startErr = _.find(validate, function(err) { return err.path === 'start'; }) || ''
    
    .form-group(class=(startErr ? 'has-error' : ''))
      label.col-sm-2.control-label(for='start')= __('Start time')
      .col-sm-10
        .input-group.date#startpicker
          span.input-group-addon
            span.fa.fa-fw.fa-clock-o
          input#start.form-control(type='text' name='start' placeholder=__('Start time') value=session.start aria-describedby='starthelp')
        span#starthelp.help-block= __(startErr ? startErr.message : 'Set with the time when you started to write.')
        
    - var durErr = _.find(validate, { path: 'duration' }) || ''

    .form-group(class=(durErr ? 'has-error' : ''))
      label.col-sm-2.control-label(for='duration')= __('Session duration (min or min:sec)')
      .col-sm-10
        .row
          .col-sm-12
            input#duration.form-control(type='texts' name='duration' placeholder=__('Session duration') value=session.duration aria-describedby='durationhelp' disabled=session.duration === null)
            span#durationhelp.help-block= __(durErr ? durErr.message : 'How much time you spent writing.')
        .row
          .col-sm-12
            .checkbox
              label
                input#noduration(type='checkbox' name='noduration' checked=session.duration === null aria-describedby="nodurationhelp")
                | I don't know
            span#nodurationhelp.help-block Check if you didn't measure the session time.
        
    - var pausedErr = _.find(validate, function(err) { return err.path === 'pausedTime' || err.path === 'pausedLessThanDuration'; }) || ''

    .form-group(class=(pausedErr ? 'has-error' : ''))
      label.col-sm-2.control-label(for='pausedTime')= __('Time not writing (min or min:sec)')
      .col-sm-10
        input#pausedTime.form-control(type='texts' name='pausedTime' placeholder=__('Time not writing') value=session.pausedTime aria-describedby='pausedTimehelp' disabled=session.pausedTime === null)
        span#pausedTimehelp.help-block= __(pausedErr ? pausedErr.message : 'How much of the time from the field above was wasted not writing.')
        
    - var wcErr = _.find(validate, { path: 'wordcount' }) || ''

    .form-group(class=(wcErr ? 'has-error' : ''))
      label.col-sm-2.control-label(for='wordcount')= __('Words written')
      .col-sm-10
        input#wordcount.form-control(type='number' name='wordcount' placeholder=__('Words written') value=session.wordcount aria-describedby='wchelp')
        span#wchelp.help-block= __(wcErr ? wcErr.message : 'The amount of words you\'ve written during this session.')
    
    .form-group
      .col-sm-10.col-sm-offset-2
        .checkbox
          label
            input#isCountdown(type='checkbox' name='isCountdown' checked=!!session.isCountdown aria-describedby='countdownhelp')
            | Countdown session
          span#countdownhelp.help-block Check if you used a timer to stop writing when it beeped.
        
    .form-group
      label.col-sm-2.control-label(for='notes')= __('Notes')
      .col-sm-10
        textarea#notes.form-control(rows='3' name='notes' placeholder=__('Notes') aria-describedby='noteshelp')= session.notes
        span#help.help-block Some notes about this session, if you want to record of something later.        
    
    include ../../mixins/single-form-buttons
    
append scripts
  script(type='text/javascript', src='/bower_components/moment/min/moment-with-locales.min.js')
  script(type='text/javascript', src='/bower_components/eonasdan-bootstrap-datetimepicker/build/js/bootstrap-datetimepicker.min.js')
  script.
    $(document).ready(function () {
      $('#startpicker').datetimepicker({
        format: '!{user.settings.dateFormat} !{user.settings.timeFormat}',
        defaultDate: moment()
      });
      $('#zoneOffset').val(moment().utcOffset());
      $("#noduration").change(function (e) {
        $("#duration").prop('disabled', $(this).prop('checked'));
        $("#pausedTime").prop('disabled', $(this).prop('checked'));
      });
    })
  if user.settings.showTour
    script
      unless edit
        | tour(jQuery, hopscotch, range(36, 37));
    
append styles
  link(rel='stylesheet', href='/bower_components/eonasdan-bootstrap-datetimepicker/build/css/bootstrap-datetimepicker.min.css')